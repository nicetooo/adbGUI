# Gaze Roadmap - 功能优化与新增建议

> 基于对整个 Gaze 代码库的深度分析（约34,000行前端 TypeScript/TSX + 大量 Go 后端代码），从功能缺口、用户体验优化、架构改进、生态扩展四个维度整理。

---

## 现状总结

Gaze 已经是一个**非常完整**的 Android 设备管理工具，涵盖：

| 模块 | 状态 | 说明 |
|------|------|------|
| 设备管理 | ✅ 完整 | 列表/连接/无线/批量操作/历史设备 |
| 屏幕镜像 | ✅ 完整 | scrcpy 集成，编码/分辨率/音频/摄像头等配置 |
| 应用管理 | ✅ 完整 | 安装/卸载/启停/清除，拖拽安装 APK/XAPK/AAB |
| 文件管理 | ✅ 完整 | 浏览/上传/下载/剪贴板/缩略图/隐藏文件 |
| ADB Shell | ✅ 完整 | 命令执行/历史导航 |
| Logcat | ✅ 完整 | 虚拟滚动(50k)、结构化解析、级别/正则过滤、预设 |
| HTTP/HTTPS 代理 | ✅ 完整 | MITM、请求检查、WebSocket、限速、Mock、证书 |
| 触摸录制 | ✅ 完整 | 快速/精确模式、脚本管理、任务编排 |
| UI Inspector | ✅ 完整 | 层级树、元素搜索、操作执行 |
| 可视化工作流 | ✅ 完整 | 25+ 步骤类型、分支/变量/子工作流、React Flow |
| 事件时间线 | ✅ 完整 | 统一事件、书签、断言、网络瀑布图、视频同步 |
| Session 管理 | ✅ 完整 | 创建/结束/导出/导入/统计 |
| MCP 集成 | ✅ 完整 | 全部功能通过 MCP 工具暴露 |
| 国际化 | ⚠️ 部分 | en/zh 完整，ja/ko/zh-TW 缺少4个命名空间 |
| 主题 | ✅ 完整 | 亮色/暗色/跟随系统，macOS 原生风格 |

---

## 一、高价值新功能

### 1. 性能监控仪表盘 (Performance Dashboard)

- **现状**: `event_types.go` 中已定义 `perf_sample` 事件类型和 `PerfSampleData` 结构体（CPU/Memory/FPS/Network），但**前端没有专门的性能可视化页面**
- **建议**: 新增 `PerfView` 页面，用 recharts 绘制实时 CPU/内存/FPS/网络流量折线图，支持历史对比、阈值告警，可按 Session 记录性能基线
- **价值**: Android 开发者高频需求，后端事件基础设施已就绪
- **工作量**: 中等（前端新页面 + 后端数据采集增强）

### 2. 崩溃/ANR 分析面板

- **现状**: 事件系统支持 `app_crash` 和 `app_anr` 事件类型，但没有专门的崩溃分析 UI
- **建议**: 新增崩溃收集面板，自动从 logcat 中提取 Java/Native crash stacktrace，按包名/异常类型聚合，支持 symbolicate（符号化）、频率统计、崩溃趋势图
- **价值**: 配合 MCP 工具让外部 AI 自动分析崩溃原因
- **工作量**: 中等

### 3. 多设备同步操作 (Multi-Device Sync)

- **现状**: 有批量操作（BatchOperation），但仅限于批量执行同一命令
- **建议**: 支持多设备同步镜像显示（多屏幕并排）、同步触控（一台操作，多台跟随）、多设备工作流并行执行和结果对比
- **价值**: 兼容性测试的核心需求
- **工作量**: 大

### 4. 网络请求 Mock 可视化编辑器

- **现状**: ProxyStore 支持 mockRules，但前端 Mock 规则编辑比较基础
- **建议**: 增强 Mock 规则编辑器，支持可视化配置 URL Pattern、Response Body 编辑器（JSON/XML syntax highlight）、延迟模拟、条件匹配（Header/Query/Body）、Mock 数据模板（Faker.js 风格）
- **价值**: 前后端联调的高频场景
- **工作量**: 中等

### 5. 截图对比 / UI 回归测试

- **现状**: 有截图能力（screen_screenshot），有断言系统（assertion）
- **建议**: 新增截图基线管理功能：保存基线截图 → 执行工作流后自动截图 → 像素级/感知级对比 → 高亮差异区域 → 生成报告
- **价值**: 自动化 UI 回归测试的核心能力
- **工作量**: 大

### 6. 设备日志导出 / Bug Report 一键收集

- **现状**: 有 logcat 和事件存储，但缺少一键导出完整 bug report
- **建议**: 一键执行 `adb bugreport`，同时打包当前 Session 的所有事件、logcat、网络请求、截图、录屏为一个 ZIP 包，支持分享
- **价值**: QA 团队提 bug 的标准化流程
- **工作量**: 小

### 7. 深度链接 / Intent 测试工具

- **现状**: ADB Shell 可以手动执行 `am start`
- **建议**: 专门的 Deep Link 测试面板：输入 URL/Intent，一键发送到设备；维护 Deep Link 收藏夹；自动从 APK manifest 提取已注册的 scheme 和 intent-filter
- **价值**: 移动端开发高频测试场景
- **工作量**: 小

---

## 二、用户体验优化

### 8. 视图持久化 (Keep-Alive)

- **现状**: `App.tsx` 中有注释提到 keep-alive，但实际是条件渲染（切换视图时组件被卸载，滚动位置/展开状态等 DOM 状态丢失）
- **建议**: 使用 `display: none` 代替条件渲染来保持 DOM 状态，或实现真正的 keep-alive 机制。尤其对 Logcat、EventTimeline 等重数据页面，避免切换时重新渲染
- **工作量**: 小

### 9. 全局搜索 (Cmd+K / Spotlight)

- **建议**: 实现全局搜索面板（类似 VS Code 的 Cmd+P），可以搜索：设备名、包名、文件路径、logcat 内容、事件、工作流、Shell 命令历史等，一键跳转到对应页面
- **价值**: 提升复杂场景下的导航效率
- **工作量**: 中等

### 10. 键盘快捷键系统

- **现状**: Shell 有方向键历史，但整体缺少快捷键
- **建议**:
  - `Cmd+1~9` 切换视图
  - `Cmd+K` 全局搜索
  - `Cmd+Shift+S` 截图
  - `Cmd+R` 开始/停止录制
  - `Space` 暂停/继续 logcat
  - 支持快捷键自定义
- **工作量**: 中等

### 11. i18n 翻译补全

- **现状**: `ja.json`、`ko.json`、`zh-TW.json` 缺少 `session`、`session_manager`、`assertions`、`recording` 4 个命名空间的翻译（约 300+ 条目）
- **建议**: 补全所有语言的翻译，确保 5 种语言体验一致
- **工作量**: 小

### 12. 拖拽排序工作流步骤

- **现状**: 工作流使用 React Flow 可视化编辑，但重新排序需要手动调整连线
- **建议**: 在工作流列表视图中支持拖拽排序步骤；在画布视图中增强自动布局算法（已引入 dagre，可增强）
- **工作量**: 小

### 13. Logcat 日志高亮规则

- **现状**: Logcat 支持颜色区分 Level，但缺少自定义高亮
- **建议**: 允许用户定义高亮规则（正则匹配 → 自定义背景色/前景色），例如高亮特定 Tag、特定关键词
- **工作量**: 小

---

## 三、架构与性能优化

### 14. 前端测试覆盖

- **现状**: 引入了 Vitest + jsdom，但未见测试文件
- **建议**:
  - 为 Zustand Store 编写单元测试（纯逻辑，最容易测）
  - 为工具函数编写测试（`eventTypes.ts` 中的 format/filter 函数）
  - 为关键工作流交互编写集成测试
- **工作量**: 持续性

### 15. 后端测试覆盖

- **建议**:
  - EventStore SQLite 操作的单元测试
  - EventPipeline 事件处理流程测试
  - Workflow 引擎执行逻辑测试（分支、循环、变量替换）
  - Proxy Mock 规则匹配测试
- **工作量**: 持续性

### 16. 大数据场景优化

- **现状**: Logcat 限制 50k 条，Proxy 限制 5k 条
- **建议**:
  - 引入分页加载 + 无限滚动，突破固定上限
  - EventStore 的 SQLite 查询增加游标分页
  - 长时间 Session 的事件可以按时间分片懒加载
- **工作量**: 中等

### 17. Store 拆分优化

- **现状**: 33 个 Store 文件，有些 Store 非常庞大（eventStore 831 行，automationStore 743 行）
- **建议**: 将大型 Store 拆分为多个 slice（使用 Zustand 的 slice pattern），提高可维护性
- **工作量**: 中等

### 18. 离线/缓存策略

- **建议**:
  - 设备配置本地缓存（scrcpy 参数、logcat 过滤器预设等）
  - 工作流本地自动保存 + 版本历史
  - Session 数据的增量同步（避免重复加载）
- **工作量**: 中等

---

## 四、生态与扩展

### 19. 插件系统

- **建议**: 设计简单的插件机制，允许用户编写自定义脚本/插件来扩展功能：
  - 自定义事件处理器（如特定格式的日志解析）
  - 自定义工作流步骤类型
  - 自定义代理拦截规则
- **价值**: 让社区贡献扩展，增加产品粘性
- **工作量**: 大

### 20. 工作流市场 / 模板库

- **现状**: 工作流支持 JSON 导入/导出
- **建议**: 内置常用工作流模板（登录流程、权限测试、性能压测、Monkey 测试），或提供在线模板库供下载
- **价值**: 降低工作流创建门槛
- **工作量**: 中等

### 21. CI/CD 集成

- **建议**:
  - 提供 CLI 模式（headless），可以在 CI 中运行工作流、收集报告
  - 生成 JUnit XML 格式的测试报告
  - 支持 GitHub Actions / Jenkins 插件
  - MCP 已提供 API 基础，但缺少 CLI wrapper
- **价值**: 企业级需求
- **工作量**: 大

### 22. 团队协作功能

- **建议**:
  - Session / 工作流分享（导出为可分享的链接或文件）
  - 工作流版本管理（Git-like 变更历史）
  - 团队 Session 模板（标准化测试流程）
- **工作量**: 大

### 23. 云端设备支持

- **建议**: 支持连接云端 Android 设备服务（如 Firebase Test Lab、AWS Device Farm），扩展 `device_connect` 支持远程设备
- **工作量**: 大

### 24. Appium 协议兼容

- **建议**: 实现 Appium WebDriver 协议的子集，让现有 Appium 测试脚本可以通过 Gaze 执行，降低迁移成本
- **工作量**: 大

---

## 优先级矩阵

| 优先级 | 编号 | 功能 | 原因 |
|--------|------|------|------|
| **P0** | #1 | 性能监控仪表盘 | 后端已就绪，投入产出比最高 |
| **P0** | #11 | i18n 翻译补全 | 现有功能的完善，工作量小 |
| **P1** | #2 | 崩溃/ANR 分析 | 开发者核心需求 |
| **P1** | #6 | Bug Report 一键收集 | QA 团队刚需 |
| **P1** | #8 | 视图持久化 | 体验改善明显 |
| **P1** | #13 | Logcat 日志高亮 | 开发者常用，工作量小 |
| **P2** | #9 | 全局搜索 | 效率提升 |
| **P2** | #5 | 截图对比 | 自动化测试完整性 |
| **P2** | #7 | Deep Link 测试 | 开发者常用 |
| **P2** | #10 | 键盘快捷键 | 效率提升 |
| **P2** | #14 | 前端测试覆盖 | 长期质量保证 |
| **P2** | #15 | 后端测试覆盖 | 长期质量保证 |
| **P3** | #3 | 多设备同步 | 兼容性测试场景 |
| **P3** | #4 | Mock 编辑器增强 | 联调场景 |
| **P3** | #12 | 工作流拖拽排序 | 编辑体验 |
| **P3** | #16 | 大数据优化 | 极端场景 |
| **P3** | #17 | Store 拆分 | 可维护性 |
| **P3** | #18 | 离线/缓存 | 体验优化 |
| **P4** | #19 | 插件系统 | 生态建设 |
| **P4** | #20 | 工作流模板库 | 降低门槛 |
| **P4** | #21 | CI/CD 集成 | 企业级需求 |
| **P4** | #22 | 团队协作 | 企业级需求 |
| **P4** | #23 | 云端设备 | 远程测试 |
| **P4** | #24 | Appium 兼容 | 迁移成本 |

---

## 快速实现路径建议

### Phase 1 — 补全与打磨（1-2 周）
- [x] 补全 ja/ko/zh-TW 翻译 (#11)
- [x] 视图 Keep-Alive (#8)
- [x] Logcat 高亮规则 (#13)
- [x] 工作流自动布局增强 (#12)

### Phase 2 — 核心新功能（2-4 周）
- [ ] 性能监控仪表盘 (#1)
- [ ] 崩溃/ANR 分析面板 (#2)
- [ ] Bug Report 一键收集 (#6)
- [ ] Deep Link 测试工具 (#7)

### Phase 3 — 高级功能（1-2 月）
- [ ] 全局搜索 (#9)
- [ ] 键盘快捷键系统 (#10)
- [ ] 截图对比 / UI 回归 (#5)
- [ ] Mock 编辑器增强 (#4)
- [ ] 前后端测试覆盖 (#14, #15)

### Phase 4 — 生态扩展（长期）
- [ ] 多设备同步 (#3)
- [ ] CI/CD 集成 (#21)
- [ ] 工作流模板库 (#20)
- [ ] 插件系统 (#19)
- [ ] 团队协作 (#22)
