# Gaze

Мощный, современный и полностью автономный инструмент для управления и автоматизации Android-устройств, созданный с использованием **Wails**, **React** и **Ant Design**. Включает унифицированную архитектуру **Session-Event** для полного отслеживания поведения устройства, визуальный движок **Workflow** для автоматизации тестирования и полную интеграцию с **MCP** (Model Context Protocol) для управления устройствами с помощью ИИ.

> **Примечание**: Это приложение — результат чистого **vibecoding**.

[English](README.md) | [简体中文](locales/README.zh-CN.md) | [繁體中文](locales/README.zh-TW.md) | [日本語](locales/README.ja.md) | [한국어](locales/README.ko.md) | [Español](locales/README.es.md) | [Português](locales/README.pt.md) | [Français](locales/README.fr.md) | [Deutsch](locales/README.de.md) | [Русский](locales/README.ru.md) | [Tiếng Việt](locales/README.vi.md) | [العربية](locales/README.ar.md)

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Platform](https://img.shields.io/badge/platform-macOS%20%7C%20Windows%20%7C%20Linux-lightgrey.svg)
[![Website](https://img.shields.io/website?up_message=online&url=https%3A%2F%2Fgaze.nicetooo.com)](https://gaze.nicetooo.com)

## Почему Gaze?

- **Современный и быстрый**: Построен на Wails (Go + React), обеспечивает производительность, близкую к нативной, при минимальном потреблении ресурсов.
- **Полностью автономный**: Не требует установки `adb`, `scrcpy`, `aapt`, `ffmpeg` или `ffprobe` в системе. Все встроено и готово к работе.
- **Надежная передача файлов**: Надёжная альтернатива часто сбоящему *Android File Transfer* на macOS.
- **Поддержка нескольких устройств**: Независимая одновременная фоновая запись для нескольких устройств.
- **Архитектура Session-Event**: Унифицированное отслеживание всех действий устройства (логи, сеть, касания, жизненный цикл приложений) на единой временной шкале.
- **Визуальная автоматизация Workflow**: Создание сложных тестовых сценариев с помощью редактора узлов с перетаскиванием — без написания кода.
- **Готовность к ИИ через MCP**: Более 50 инструментов, доступных через Model Context Protocol для бесшовной интеграции с ИИ-клиентами, такими как Claude Desktop и Cursor.
- **Для разработчиков**: Встроенные Logcat, Shell, MITM Proxy и UI Inspector, созданные разработчиками для разработчиков.

## Скриншоты приложения

| Управление устройствами | Зеркалирование экрана |
|:---:|:---:|
| <img src="screenshots/devices.png" width="400" /> | <img src="screenshots/mirror.png" width="400" /> |

| Файловый менеджер | Управление приложениями |
|:---:|:---:|
| <img src="screenshots/files.png" width="400" /> | <img src="screenshots/apps.png" width="400" /> |

| Монитор производительности | Временная шкала сессии |
|:---:|:---:|
| <img src="screenshots/performance.png" width="400" /> | <img src="screenshots/session.png" width="400" /> |

| Список сессий | Просмотр Logcat |
|:---:|:---:|
| <img src="screenshots/session-list.png" width="400" /> | <img src="screenshots/logcat.png" width="400" /> |

| Визуальный редактор рабочих процессов | Список рабочих процессов |
|:---:|:---:|
| <img src="screenshots/workflow-editor.png" width="400" /> | <img src="screenshots/workflow.png" width="400" /> |

| UI Инспектор | Запись касаний |
|:---:|:---:|
| <img src="screenshots/ui-inspector.png" width="400" /> | <img src="screenshots/recording.png" width="400" /> |

| Сетевой прокси (MITM) | ADB Shell |
|:---:|:---:|
| <img src="screenshots/proxy.png" width="400" /> | <img src="screenshots/shell.png" width="400" /> |

---

## Возможности

### Управление устройствами
- **Единый список устройств**: Бесшовное управление физическими и беспроводными устройствами с автоматическим объединением USB/Wi-Fi.
- **Беспроводное подключение**: Легкое подключение через сопряжение по IP/Порту с поддержкой mDNS.
- **История устройств**: Быстрый доступ к ранее подключенным офлайн-устройствам.
- **Закрепление устройства**: Закрепите наиболее часто используемое устройство, чтобы оно всегда оставалось в верхней части списка.
- **Мониторинг устройства**: Отслеживание изменений состояния батареи, сети и экрана в реальном времени.
- **Пакетные операции**: Выполнение операций на нескольких устройствах одновременно.

### Управление приложениями
- **Полный контроль пакетов**: Установка (Drag & Drop), удаление, включение, отключение, принудительная остановка, очистка данных.
- **Управление APK**: Экспорт установленных APK, пакетная установка.
- **Умная фильтрация**: Поиск и фильтрация по системным/пользовательским приложениям.
- **Быстрые действия**: Запуск приложений или переход непосредственно к их логам.

### Зеркалирование экрана (Scrcpy)
- **Высокая производительность**: Зеркалирование с низкой задержкой на базе Scrcpy.
- **Запись**: Независимая фоновая запись с поддержкой одновременной записи нескольких устройств и доступом к папке в один клик.
- **Передача звука**: Потоковая передача звука устройства на компьютер (Android 11+).
- **Настройка**: Регулировка разрешения, битрейта, FPS и кодека (H.264/H.265).
- **Управление**: Поддержка мультитач, предотвращение засыпания, режим выключенного экрана.

### Управление файлами
- **Полнофункциональный проводник**: Просмотр, копирование, вырезание, вставка, переименование, удаление и создание папок.
- **Drag & Drop**: Загрузка файлов простым перетаскиванием в окно.
- **Загрузки**: Легкая передача файлов с устройства на компьютер.
- **Предпросмотр**: Открытие файлов напрямую на хост-машине.

### Продвинутый Logcat
- **Поток в реальном времени**: Просмотр логов в реальном времени с управлением автопрокруткой.
- **Мощная фильтрация**: Фильтрация по уровню лога, тегу, PID или пользовательскому Regex.
- **Ориентация на приложение**: Автоматическая фильтрация логов для конкретного приложения.
- **Форматирование JSON**: Автоматическое форматирование обнаруженных JSON-фрагментов в логах.

### Сеть и прокси (MITM)
- **Автоматический перехват**: Запуск HTTP/HTTPS прокси-сервера в один клик с автоматической настройкой прокси на устройстве через ADB.
- **Расшифровка HTTPS (MITM)**: Поддержка расшифровки SSL-трафика с автоматической генерацией и установкой CA-сертификата.
- **Поддержка WebSocket**: Перехват и анализ трафика WebSocket в реальном времени.
- **Работа с большими данными**: Поддержка полного захвата тела запросов (до 100 МБ) без обрезки, с буфером на 5000 записей.
- **Управление трафиком**: Имитация реальных сетевых условий с ограничением скорости загрузки/выгрузки для каждого устройства и искусственной задержкой.
- **Визуальные метрики**: Мониторинг скорости RX/TX в реальном времени для выбранного устройства.

### Session и отслеживание событий
- **Унифицированный конвейер событий**: Все действия устройства (логи, сетевые запросы, события касания, жизненный цикл приложений, проверки утверждений) фиксируются как события и привязываются к временной шкале сессии.
- **Автоматическое управление сессиями**: Сессии создаются автоматически при возникновении событий или вручную с пользовательскими настройками (logcat, запись, прокси, мониторинг).
- **Временная шкала событий**: Многодорожечная визуализация всех событий с индексацией и навигацией по времени.
- **Полнотекстовый поиск**: Поиск по всем событиям с использованием SQLite FTS5.
- **Контроль обратного давления**: Автоматическая выборка событий при высокой нагрузке с защитой критических событий (ошибки, сеть, workflow).
- **Проверки утверждений**: Определение и оценка утверждений по потокам событий для автоматической валидации.
- **Синхронизация видео**: Извлечение видеокадров, синхронизированных с временными метками событий, для визуальной отладки.

### UI Inspector и автоматизация
- **Инспектор UI-иерархии**: Просмотр и анализ полного дерева UI любого экрана.
- **Выбор элементов**: Нажмите для выбора UI-элемента и просмотра его свойств (resource-id, text, bounds, class).
- **Запись касаний**: Запись взаимодействий касанием и воспроизведение в виде скриптов автоматизации.
- **Действия на основе элементов**: Нажатие, долгое нажатие, ввод текста, свайп, ожидание и проверка UI-элементов с помощью селекторов (id, text, contentDesc, className, xpath).

### Визуальный движок Workflow
- **Редактор на основе узлов**: Визуальное построение потоков автоматизации с помощью интерфейса перетаскивания на базе XYFlow.
- **Более 30 типов шагов**: Нажатие, свайп, взаимодействие с элементами, управление приложениями, клавиатурные события, управление экраном, ожидание, команды ADB, переменные, ветвление, подпроцессы и управление сессиями.
- **Условное ветвление**: Создание интеллектуальных потоков с условиями exists/not_exists/text_equals/text_contains.
- **Переменные и выражения**: Использование переменных workflow с поддержкой арифметических выражений (`{{count}} + 1`).
- **Пошаговая отладка**: Пауза, пошаговое выполнение и проверка состояния переменных на каждом шаге workflow.
- **Интеграция с Session**: Запуск/остановка сессий отслеживания внутри workflow для комплексной отчетности по тестам.

### ADB Shell
- **Встроенная консоль**: Выполнение сырых команд ADB прямо внутри приложения.
- **История команд**: Быстрый доступ к ранее выполненным командам.

### Системный трей
- **Быстрый доступ**: Управление зеркалированием и просмотр статуса устройства из строки меню/системного трея.
- **Закрепление устройства**: Закрепите основное устройство, чтобы оно отображалось в верхней части списка и меню трея.
- **Функции трея**: Прямой доступ к Logcat, Shell и файловому менеджеру для закрепленных устройств из трея.
- **Индикаторы записи**: Визуальный индикатор красной точки в трее, когда запись активна.
- **Фоновая работа**: Работа приложения в фоне для мгновенного доступа.

---

## Интеграция MCP (Model Context Protocol)

Gaze включает встроенный **MCP-сервер**, предоставляющий более 50 инструментов и 5 ресурсов, что позволяет ИИ-клиентам полностью управлять Android-устройствами на естественном языке. Gaze — это мост между ИИ и Android.

### Поддерживаемые ИИ-клиенты

| Клиент | Транспорт | Конфигурация |
|--------|-----------|--------------|
| **Claude Desktop** | SSE | `claude_desktop_config.json` |
| **Claude Code (CLI)** | SSE | `.claude/settings.json` |
| **Cursor** | SSE | Настройки MCP в Cursor |

### Быстрая настройка

MCP-сервер запускается автоматически вместе с Gaze по адресу `http://localhost:23816/mcp/sse`.

**Claude Desktop** (`claude_desktop_config.json`):
```json
{
  "mcpServers": {
    "gaze": {
      "url": "http://localhost:23816/mcp/sse"
    }
  }
}
```

**Claude Code**:
```bash
claude mcp add gaze --transport sse http://localhost:23816/mcp/sse
```

**Cursor**: Добавьте URL MCP-сервера `http://localhost:23816/mcp/sse` в настройках MCP в Cursor.

### Инструменты MCP (более 50)

| Категория | Инструменты | Описание |
|-----------|-------------|----------|
| **Устройства** | `device_list`, `device_info`, `device_connect`, `device_disconnect`, `device_pair`, `device_wireless`, `device_ip` | Обнаружение, подключение устройств и получение информации |
| **CLI-инструменты** | `adb_execute`, `aapt_execute`, `ffmpeg_execute`, `ffprobe_execute` | Выполнение встроенных CLI-инструментов (ADB, AAPT, FFmpeg, FFprobe) |
| **Приложения** | `app_list`, `app_info`, `app_start`, `app_stop`, `app_running`, `app_install`, `app_uninstall`, `app_clear_data` | Полное управление жизненным циклом приложений |
| **Экран** | `screen_screenshot`, `screen_record_start`, `screen_record_stop`, `screen_recording_status` | Скриншоты (base64) и управление записью |
| **UI-автоматизация** | `ui_hierarchy`, `ui_search`, `ui_tap`, `ui_swipe`, `ui_input`, `ui_resolution` | Инспекция UI, взаимодействие с элементами и ввод |
| **Сессии** | `session_create`, `session_end`, `session_active`, `session_list`, `session_events`, `session_stats` | Жизненный цикл сессий и запрос событий |
| **Workflow** | `workflow_list`, `workflow_get`, `workflow_create`, `workflow_update`, `workflow_delete`, `workflow_run`, `workflow_stop`, `workflow_pause`, `workflow_resume`, `workflow_step_next`, `workflow_status`, `workflow_execute_step` | Полный CRUD, выполнение и отладка workflow |
| **Прокси** | `proxy_start`, `proxy_stop`, `proxy_status` | Управление сетевым прокси |
| **Видео** | `video_frame`, `video_metadata`, `session_video_frame`, `session_video_info` | Извлечение видеокадров и метаданных |

### Ресурсы MCP

| URI | Описание |
|-----|----------|
| `gaze://devices` | Список подключенных устройств |
| `gaze://devices/{deviceId}` | Подробная информация об устройстве |
| `gaze://sessions` | Активные и недавние сессии |
| `workflow://list` | Все сохраненные workflow |
| `workflow://{workflowId}` | Детали workflow с шагами |

### Что может делать ИИ с Gaze?

Благодаря интеграции с MCP, ИИ-клиенты могут:
- **Автоматизировать тестирование**: Создавать и запускать workflow UI-тестов с помощью инструкций на естественном языке.
- **Отлаживать проблемы**: Делать скриншоты, инспектировать UI-иерархию, читать логи и анализировать сетевой трафик.
- **Управлять устройствами**: Устанавливать приложения, передавать файлы, настраивать параметры на нескольких устройствах.
- **Создавать Workflow**: Генерировать сложные workflow автоматизации с условным ветвлением и управлением переменными.
- **Мониторить сессии**: Отслеживать поведение устройства во времени с помощью записи сессий на основе событий.

---

## Встроенные бинарные файлы

Это приложение полностью автономно. Оно включает:
- **ADB** (Android Debug Bridge)
- **Scrcpy** (Зеркалирование и запись экрана)
- **AAPT** (Android Asset Packaging Tool)
- **FFmpeg** (Обработка видео/аудио)
- **FFprobe** (Анализ медиафайлов)

При запуске они извлекаются во временную директорию и используются автоматически. Вам не нужно настраивать системный PATH.

---

## Важные примечания для пользователей Xiaomi/Poco/Redmi

Чтобы включить **сенсорное управление** в Scrcpy, необходимо:
1. Перейти в **Параметры разработчика**.
2. Включить **Отладку по USB**.
3. Включить **Отладку по USB (Настройки безопасности)**.
   *(Примечание: на большинстве устройств Xiaomi для этого требуется SIM-карта и вход в аккаунт Mi).*

---

## Начало работы

### Требования
- **Go** (v1.23+)
- **Node.js** (v18 LTS)
- **Wails CLI** (v2.9.2)
  ```bash
  go install github.com/wailsapp/wails/v2/cmd/wails@v2.9.2
  ```

### Разработка
```bash
wails dev
```

### Сборка
```bash
wails build
```
Скомпилированное приложение будет доступно в `build/bin`.

### Запуск тестов
```bash
go test ./...
```

### Релиз
Этот проект использует GitHub Actions для автоматизации мультиплатформенной сборки. Чтобы создать новый релиз:
1. Создайте тег для вашего коммита: `git tag v1.0.0`
2. Отправьте тег: `git push origin v1.0.0`
GitHub Action автоматически соберет версии для macOS, Windows и Linux и загрузит артефакты на страницу релизов.

---

## Обзор архитектуры

```
                    +-----------------+
                    |   Wails (GUI)   |
                    +--------+--------+
                             |
              +--------------+--------------+
              |                             |
     +--------v--------+          +--------v--------+
     |  React Frontend |          |   Go Backend    |
     |  (Ant Design,   |          |  (App, Device,  |
     |   Zustand,      |          |   Automation,   |
     |   XYFlow)       |          |   Workflow)     |
     +-----------------+          +--------+--------+
                                           |
                         +-----------------+-----------------+
                         |                 |                 |
                +--------v------+  +-------v-------+  +-----v-------+
                | Event Pipeline|  |  MCP Server   |  |   Proxy     |
                | (Session,     |  |  (50+ tools,  |  |  (MITM,     |
                |  SQLite,      |  |   5 resources)|  |   goproxy)  |
                |  FTS5)        |  +---------------+  +-------------+
                +---------------+
```

---

## Технологический стек

| Уровень | Технология |
|---------|-----------|
| **Фреймворк** | Wails v2 |
| **Бэкенд** | Go 1.23+ |
| **Фронтенд** | React 18, TypeScript, Ant Design 6 |
| **Управление состоянием** | Zustand |
| **Редактор Workflow** | XYFlow + Dagre |
| **База данных** | SQLite (WAL mode, FTS5) |
| **Прокси** | goproxy |
| **MCP** | mcp-go (Model Context Protocol) |
| **Интернационализация** | i18next (5 языков) |
| **Логирование** | zerolog |
| **Графики** | Recharts |

---

## Устранение неполадок

### macOS: "Программа повреждена и не может быть открыта"
Если вы скачиваете приложение с GitHub и видите ошибку *"Gaze.app поврежден и не может быть открыт"*, это связано с карантином macOS Gatekeeper.

Чтобы исправить это, выполните следующую команду в терминале:
```bash
sudo xattr -cr /path/to/Gaze.app
```
*(Замените `/path/to/Gaze.app` на фактический путь к скачанному приложению)*

> **Или соберите самостоятельно:** Если вы не хотите обходить Gatekeeper, вы можете легко [собрать приложение из исходного кода](#начало-работы) локально. Это займет всего несколько минут!

### Windows: "Система Windows защитила ваш компьютер"
Если вы видите синее окно SmartScreen, блокирующее запуск приложения:
1. Нажмите **Подробнее**.
2. Нажмите **Выполнить в любом случае**.

---

## Лицензия
Этот проект лицензирован на условиях лицензии MIT.
