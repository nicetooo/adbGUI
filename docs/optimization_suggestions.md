# Gaze 项目优化建议

基于对代码的深入分析，以下从三个角度列出可能的优化点。

---

## 1. 用户角度 (UX/UI)

### 1.1 交互体验

| 问题 | 位置 | 建议 |
|------|------|------|
| **设备切换时无状态保持** | `App.tsx:172-208` | 切换设备后应保留当前视图和滚动位置，而非重新加载 |
| **无批量操作支持** | `AppsView.tsx`, `FilesView.tsx` | 应用管理/文件管理缺少多选批量操作（批量卸载、批量删除） |
| **无拖拽上传进度** | `FilesView.tsx` | 文件上传时缺少进度条显示 |
| **Modal 确认框过多** | `AppsView.tsx:363-391` | 危险操作可考虑撤销机制替代反复确认 |
| **无键盘快捷键** | 全局 | 缺少 `Cmd+R` 刷新、`Cmd+F` 搜索等快捷键 |
| **Logcat 无导出功能** | `LogcatView.tsx` | 用户可能需要导出日志到文件 |

### 1.2 视觉反馈

| 问题 | 建议 |
|------|------|
| 录屏/镜像状态不够醒目 | 考虑在侧边栏图标上添加小红点或动画指示 |
| 设备离线状态不直观 | 离线设备应灰显或添加明显标识 |
| 代理抓包成功/失败无颜色区分 | HTTP 状态码应使用更明显的颜色编码 (2xx 绿色, 4xx 橙色, 5xx 红色) |

### 1.3 文案与国际化

| 问题 | 位置 |
|------|------|
| 部分硬编码英文 | `ProxyView.tsx:441` "Cert", "Rules" 未使用 `t()` |
| 错误信息不友好 | 直接显示后端错误，应翻译为用户可理解的语言 |

---

## 2. 架构、性能、可维护性

### 2.1 架构问题

| 问题 | 位置 | 建议 |
|------|------|------|
| **`app.go` 过于庞大** | `app.go` (3760行) | 拆分为多个模块：`device.go`, `scrcpy.go`, `proxy.go`, `apps.go`, `files.go` |
| **前端状态管理混乱** | `App.tsx` (900+行) | 使用 Zustand 或 Jotai 替代 prop drilling，提取 `useDevices`, `useMirror`, `useLogcat` 等自定义 hooks |
| **过多 `useRef` 同步 state** | `App.tsx:140-170` | 6 个 `useRef` 用于同步 filter 状态，应重构事件处理逻辑 |
| **接口类型重复定义** | `App.tsx:69-79`, `FilesView.tsx:44-49` | `Device` 接口在多处重复，应统一在 `types.ts` |
| **`// @ts-ignore` 过多** | 多处 | Wails 绑定类型应正确导入，消除 ts-ignore |

### 2.2 性能问题

| 问题 | 位置 | 建议 |
|------|------|------|
| **设备轮询效率低** | `App.tsx:593-620` | 每 3 秒调用 `GetDevices`，应改为后端 push 事件或增量更新 |
| **缩略图重复请求** | `FilesView.tsx:76-86` | `GetThumbnail` 无前端缓存，切换目录后再返回会重新请求 |
| **Logcat 内存无上限** | `App.tsx:341-344` | 最多保留 200,000 条日志，可能导致内存问题，建议降至 50,000 或使用虚拟化 |
| **APK 图标解析阻塞** | `app.go:966-1049` | `extractIconFromAPK` 同步执行，大量应用时会阻塞 UI |
| **代理日志无限增长** | `ProxyView.tsx:125` | `.slice(0, 5000)` 每次添加都创建新数组，应使用环形缓冲区 |

### 2.3 可维护性

| 问题 | 建议 |
|------|------|
| 缺少单元测试 | 添加 Go 后端测试和 React 组件测试 |
| 无 API 文档 | 为 Wails 绑定函数添加 JSDoc/GoDoc |
| 错误处理不一致 | 统一错误处理策略，封装 `handleError` 工具函数 |
| 魔法数字散落 | `200000`(日志上限), `5000`(代理日志), `20`(历史设备) 应提取为常量 |
| 无日志系统 | 后端仅用 `fmt.Printf`，应集成结构化日志库 (如 zerolog) |

---

## 3. 功能优化

### 3.1 现有功能增强

| 功能 | 当前问题 | 优化建议 |
|------|----------|----------|
| **屏幕镜像** | 无画质预设 | 添加"高清/流畅/省流"预设，一键配置分辨率、码率、帧率 |
| **屏幕镜像** | 无画面旋转 | 支持强制横屏/竖屏模式 |
| **录屏** | 仅支持 MP4 | 支持 GIF 录制（用于演示） |
| **文件管理** | 无拖拽上传 | 支持从电脑拖拽文件到设备 |
| **文件管理** | 无多文件下载 | 支持选中多个文件打包下载 |
| **应用管理** | 无 APK 安装 | 支持从电脑拖拽 APK 安装 |
| **应用管理** | 无版本显示 | 列表中应显示应用版本号 |
| **Logcat** | 无日志高亮 | 支持自定义关键词高亮（如 "Exception" 红色） |
| **Logcat** | 无书签功能 | 支持标记重要日志行，便于定位 |
| **代理** | MITM 证书安装复杂 | 一键自动安装系统证书 (需 root 或 Android 10+) |
| **代理** | 无请求重放 | 支持修改并重发请求 (类似 Postman) |
| **代理** | 无 Mock 功能 | 支持配置规则返回自定义响应 |

### 3.2 缺失功能

| 功能 | 描述 |
|------|------|
| **设备快照** | 保存/恢复设备应用列表配置 |
| **性能监控** | CPU、内存、GPU 实时曲线图 |
| **触控映射** | 键盘映射手机触控点（游戏适用） |
| **多设备同步** | 同时向多台设备发送相同指令 |
| **脚本自动化** | 支持录制/回放触控操作序列 |
| **APK 分析** | 显示 APK 权限、签名、组件等详细信息 |
| **设备分组** | 按项目/用途对设备分组管理 |
| **深色模式跟随设备** | 镜像窗口背景色跟随设备深色模式 |
| **崩溃日志提取** | 一键导出 ANR/Tombstone 日志 |
| **adb over Wi-Fi 自动配对** | 使用 mDNS 自动发现并配对设备 |

### 3.3 代码级别的功能改进

#### 后端 (app.go) 优化示例

```go
// 1. GetDevices() 应返回增量变化而非完整列表
// 2. ListPackages() 应支持分页加载
// 3. GetThumbnail() 应支持批量请求
// 4. 添加 WebSocket 推送替代轮询
```

#### 前端优化示例

```typescript
// 1. 使用 React.lazy 懒加载各 View 组件
// 2. 使用 useMemo 缓存 filteredPackages/filteredFiles
// 3. 使用 Web Worker 处理 Logcat 过滤
// 4. 添加 Service Worker 实现离线缓存
```

---

## 4. 优先级建议

### 高优先级 (影响核心体验)

1. 拆分 `app.go` 提升可维护性
2. 前端状态管理重构
3. 设备状态 push 替代轮询
4. 添加键盘快捷键

### 中优先级 (功能增强)

1. 批量操作支持
2. Logcat 导出功能
3. APK 拖拽安装
4. 屏幕镜像预设

### 低优先级 (锦上添花)

1. 性能监控图表
2. 脚本自动化
3. Mock 功能

---

## 5. 技术债务清单

- [ ] 消除所有 `// @ts-ignore`
- [ ] 统一 `Device` 接口定义到 `types.ts`
- [ ] 提取魔法数字为常量
- [ ] 添加 Go 后端单元测试
- [ ] 添加 React 组件测试
- [ ] 集成结构化日志库
- [ ] 为 Wails 绑定函数添加文档注释
